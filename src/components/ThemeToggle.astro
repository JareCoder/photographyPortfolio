---
import ThemeToggle from "./ThemeToggle";
---

<ThemeToggle client:load />

<style is:global>
  :root {
    --color-text: #000000;
    --color-background: #ffffff;
  }

  :root.dark {
    --color-text: #ffffff;
    --color-background: #000000;
  }

  body {
    color: var(--color-text);
    background-color: var(--color-background);
  }

  .theme-transition {
    transition:
      color 0.3s ease,
      background-color 0.3s ease;
  }

  /* Apply transitions to specific elements */
  body,
  .theme-transition {
    transition:
      color 0.3s ease,
      background-color 0.3s ease;
  }

  #themeToggle {
    border: 0;
    background: none;
    color: var(--color-text);
    width: 28px;
    height: 28px;
    padding: 0;
    cursor: pointer;
  }

  #themeToggle svg {
    width: 100%;
    height: 100%;
  }
</style>

<script>
  function applyTheme(theme: "light" | "dark") {
    if (theme === "light") {
      document.documentElement.classList.remove("dark");
    } else {
      document.documentElement.classList.add("dark");
    }
    document.documentElement.classList.add("theme-transition");
    window.localStorage.setItem("theme", theme);
  }

  function getThemePreference(): "light" | "dark" {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme") as "light" | "dark";
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  }

  // Apply theme on initial load
  applyTheme(getThemePreference());

  // Listen for astro:page-load event to apply theme after navigation
  document.addEventListener("astro:page-load", () => {
    applyTheme(getThemePreference());
  });

  // Listen for astro:after-swap event for view transitions
  document.addEventListener("astro:after-swap", () => {
    applyTheme(getThemePreference());
  });

  // Remove transition class to prevent transition on page load
  window.addEventListener("load", () => {
    document.documentElement.classList.remove("theme-transition");
  });
</script>
